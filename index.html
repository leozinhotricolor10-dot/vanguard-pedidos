<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vanguard Peptides â€” Pedidos</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
:root {
  --bg: #050a0e;
  --bg2: #0a1219;
  --bg3: #0f1c28;
  --accent: #00e5c3;
  --accent2: #00a8ff;
  --warn: #ff6b35;
  --text: #e2eaf0;
  --muted: #5a7a8a;
  --border: rgba(0,229,195,0.12);
  --card: rgba(10,18,25,0.85);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; overflow-x: hidden; }
body::before {
  content: ''; position: fixed; inset: 0;
  background-image: linear-gradient(rgba(0,229,195,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(0,229,195,0.02) 1px, transparent 1px);
  background-size: 40px 40px; pointer-events: none; z-index: 0;
}
.glow-bg { position: fixed; width: 600px; height: 600px; background: radial-gradient(circle, rgba(0,229,195,0.06) 0%, transparent 70%); top: -100px; left: -100px; pointer-events: none; z-index: 0; animation: blobMove 12s ease-in-out infinite alternate; }
.glow-bg2 { position: fixed; width: 400px; height: 400px; background: radial-gradient(circle, rgba(0,168,255,0.05) 0%, transparent 70%); bottom: 0; right: 0; pointer-events: none; z-index: 0; animation: blobMove2 15s ease-in-out infinite alternate; }
@keyframes blobMove { from { transform: translate(0,0); } to { transform: translate(100px, 150px); } }
@keyframes blobMove2 { from { transform: translate(0,0); } to { transform: translate(-80px, -120px); } }
@keyframes fadeUp { from { opacity:0; transform: translateY(16px); } to { opacity:1; transform: translateY(0); } }
@keyframes pulse { 0%,100% { opacity:1; transform:scale(1); } 50% { opacity:0.5; transform:scale(0.8); } }
@keyframes slideIn { from { opacity:0; transform: translateY(24px) scale(0.97); } to { opacity:1; transform: translateY(0) scale(1); } }
@keyframes popIn { from { opacity:0; transform: scale(0.85); } to { opacity:1; transform: scale(1); } }

/* NAV */
nav {
  position: fixed; top:0; left:0; right:0; z-index:100;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 32px; height: 60px;
  background: rgba(5,10,14,0.92); backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--border);
}
.logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.15rem; letter-spacing: -0.5px; color: var(--accent); display: flex; align-items: center; gap: 10px; }
.logo-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; animation: pulse 2s ease-in-out infinite; box-shadow: 0 0 12px var(--accent); }
.logo-sub { font-family: 'Space Mono', monospace; font-size: 0.62rem; color: var(--muted); letter-spacing: 2px; margin-left: 2px; }
.nav-right { display: flex; align-items: center; gap: 10px; }
.nav-btn { background: transparent; border: 1px solid var(--border); color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.68rem; padding: 6px 14px; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
.nav-btn:hover { border-color: rgba(0,229,195,0.35); color: var(--accent); }
.nav-btn.active { background: rgba(0,229,195,0.08); border-color: rgba(0,229,195,0.3); color: var(--accent); }
.cart-nav-btn { position: relative; background: transparent; border: 1px solid var(--border); color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.68rem; padding: 6px 14px; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
.cart-nav-btn:hover, .cart-nav-btn.active { background: rgba(0,229,195,0.08); border-color: rgba(0,229,195,0.3); color: var(--accent); }
.cart-badge { background: var(--accent); color: #050a0e; font-size: 0.6rem; font-weight: 700; padding: 1px 6px; border-radius: 99px; font-family: 'Syne', sans-serif; animation: popIn 0.2s ease forwards; }

/* LAYOUT */
.app { position: relative; z-index: 1; display: grid; grid-template-columns: 248px 1fr; min-height: 100vh; padding-top: 60px; }

/* SIDEBAR */
aside {
  position: sticky; top: 60px; height: calc(100vh - 60px); overflow-y: auto;
  padding: 20px 12px; border-right: 1px solid var(--border);
  background: rgba(5,10,14,0.6); display: flex; flex-direction: column;
}
aside::-webkit-scrollbar { width: 3px; }
aside::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
.name-input-label { font-family: 'Space Mono', monospace; font-size: 0.58rem; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 6px; display: block; padding-left: 2px; }
.name-input { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px; padding: 9px 12px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.85rem; outline: none; transition: border-color 0.2s; margin-bottom: 18px; }
.name-input:focus { border-color: rgba(0,229,195,0.4); }
.name-input::placeholder { color: var(--muted); }
.sidebar-section-title { font-family: 'Space Mono', monospace; font-size: 0.58rem; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 8px; padding-left: 10px; }
.cat-btn { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 8px; cursor: pointer; transition: background 0.15s; width: 100%; background: none; border: none; color: var(--text); margin-bottom: 1px; }
.cat-btn:hover { background: rgba(0,229,195,0.05); }
.cat-btn.active { background: rgba(0,229,195,0.08); }
.cat-btn.active .cat-btn-name { color: var(--accent); }
.cat-btn-icon { width: 28px; height: 28px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 13px; flex-shrink: 0; }
.cat-btn-name { font-size: 0.82rem; font-weight: 600; flex: 1; text-align: left; }
.cat-btn-count { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); }
.sidebar-divider { height: 1px; background: var(--border); margin: 14px 0; }
.cart-mini { background: rgba(0,229,195,0.05); border: 1px solid rgba(0,229,195,0.15); border-radius: 10px; padding: 12px 14px; cursor: pointer; transition: border-color 0.2s; }
.cart-mini:hover { border-color: rgba(0,229,195,0.3); }
.cart-mini-label { font-family: 'Space Mono', monospace; font-size: 0.58rem; color: var(--muted); letter-spacing: 1.5px; margin-bottom: 4px; }
.cart-mini-total { font-family: 'Syne', sans-serif; font-size: 1.25rem; font-weight: 800; color: var(--accent); }
.cart-mini-sub { font-size: 0.72rem; color: var(--muted); margin-top: 2px; }
.copy-btn { width: 100%; margin-top: 10px; background: transparent; border: 1px solid var(--border); color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.65rem; padding: 8px; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
.copy-btn:hover { border-color: rgba(0,229,195,0.35); color: var(--accent); }

/* MAIN */
main { padding: 36px 44px; max-width: 980px; }
.view { display: none; animation: fadeUp 0.4s ease forwards; }
.view.visible { display: block; }
.page-tag { display: inline-flex; align-items: center; gap: 6px; background: rgba(0,229,195,0.08); border: 1px solid rgba(0,229,195,0.2); color: var(--accent); font-size: 0.68rem; font-family: 'Space Mono', monospace; padding: 4px 12px; border-radius: 4px; margin-bottom: 12px; letter-spacing: 1px; }
.page-title { font-family: 'Syne', sans-serif; font-size: 2rem; font-weight: 800; letter-spacing: -1px; background: linear-gradient(135deg, #e2eaf0 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 6px; }
.page-sub { font-size: 0.9rem; color: var(--muted); max-width: 500px; line-height: 1.6; margin-bottom: 32px; }

/* CATEGORY */
.cat-section { margin-bottom: 44px; }
.cat-section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
.cat-section-icon { width: 36px; height: 36px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.cat-section-title { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700; }
.cat-section-count { font-family: 'Space Mono', monospace; font-size: 0.68rem; color: var(--muted); background: rgba(255,255,255,0.04); border: 1px solid var(--border); padding: 2px 10px; border-radius: 20px; margin-left: auto; }

/* PRODUCT CARDS */
.products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 14px; }
.product-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px; transition: all 0.22s; position: relative; overflow: hidden; display: flex; flex-direction: column; }
.product-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transform: scaleX(0); transform-origin: left; transition: transform 0.3s; }
.product-card:hover { border-color: rgba(0,229,195,0.3); transform: translateY(-3px); box-shadow: 0 12px 32px rgba(0,0,0,0.3); }
.product-card:hover::before { transform: scaleX(1); }
.product-card.in-cart { border-color: rgba(0,229,195,0.25); background: rgba(0,229,195,0.03); }
.product-card-name { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700; color: var(--text); margin-bottom: 4px; line-height: 1.3; }
.product-card-desc { font-size: 0.75rem; color: var(--muted); margin-bottom: 14px; line-height: 1.5; flex: 1; }
.product-card-price { font-family: 'Space Mono', monospace; font-size: 1.15rem; font-weight: 700; color: var(--accent); margin-bottom: 14px; }
.product-card-price span { font-size: 0.68rem; color: var(--muted); font-weight: 400; }
.in-cart-indicator { display: flex; align-items: center; justify-content: space-between; background: rgba(0,229,195,0.07); border: 1px solid rgba(0,229,195,0.2); border-radius: 8px; padding: 8px 12px; margin-bottom: 10px; }
.in-cart-text { font-family: 'Space Mono', monospace; font-size: 0.68rem; color: var(--accent); }
.in-cart-qty-controls { display: flex; align-items: center; gap: 8px; }
.qty-control-btn { background: rgba(0,229,195,0.1); border: 1px solid rgba(0,229,195,0.25); color: var(--accent); width: 24px; height: 24px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 700; display: flex; align-items: center; justify-content: center; transition: background 0.15s; }
.qty-control-btn:hover { background: rgba(0,229,195,0.2); }
.qty-control-num { font-family: 'Space Mono', monospace; font-size: 0.82rem; color: var(--text); min-width: 18px; text-align: center; }
.add-to-cart-btn { width: 100%; padding: 10px; border-radius: 9px; border: 1px solid rgba(0,229,195,0.35); background: transparent; color: var(--accent); font-family: 'Space Mono', monospace; font-size: 0.72rem; cursor: pointer; transition: all 0.2s; font-weight: 700; letter-spacing: 0.5px; }
.add-to-cart-btn:hover { background: rgba(0,229,195,0.08); }

/* CART VIEW */
.cart-empty { text-align: center; padding: 80px 20px; }
.cart-empty-icon { font-size: 2.8rem; margin-bottom: 16px; }
.cart-empty-title { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700; margin-bottom: 6px; }
.cart-empty-sub { font-size: 0.85rem; color: var(--muted); }
.cart-items { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
.cart-item-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px 20px; display: flex; align-items: center; gap: 16px; animation: fadeUp 0.3s ease forwards; transition: border-color 0.2s; }
.cart-item-card:hover { border-color: rgba(0,229,195,0.2); }
.cart-item-emoji { width: 36px; height: 36px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.cart-item-info { flex: 1; }
.cart-item-name { font-family: 'Syne', sans-serif; font-size: 0.9rem; font-weight: 700; margin-bottom: 2px; }
.cart-item-buyer { font-size: 0.75rem; color: var(--muted); }
.cart-item-qty-wrap { display: flex; align-items: center; gap: 8px; }
.cart-item-price { font-family: 'Space Mono', monospace; font-size: 0.88rem; color: var(--accent2); font-weight: 700; min-width: 80px; text-align: right; }
.cart-item-remove { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1rem; padding: 4px; border-radius: 6px; transition: color 0.2s; }
.cart-item-remove:hover { color: var(--warn); }
.cart-summary { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px 22px; }
.cart-summary-row { display: flex; justify-content: space-between; font-size: 0.88rem; color: var(--muted); margin-bottom: 10px; }
.cart-summary-row span:last-child { color: var(--text); font-family: 'Space Mono', monospace; }
.cart-summary-total { display: flex; justify-content: space-between; align-items: center; padding-top: 14px; margin-top: 4px; border-top: 1px solid var(--border); }
.cart-summary-total-label { font-size: 0.95rem; color: var(--text); }
.cart-summary-total-value { font-family: 'Syne', sans-serif; font-size: 1.6rem; font-weight: 800; color: var(--accent); }
.cart-note { background: rgba(255,160,50,0.06); border: 1px solid rgba(255,160,50,0.2); border-radius: 10px; padding: 12px 16px; font-size: 0.79rem; color: #a8bfc9; line-height: 1.7; margin-top: 14px; }
.checkout-btn { width: 100%; margin-top: 14px; padding: 14px; border-radius: 11px; border: none; background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #050a0e; font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 800; cursor: pointer; transition: filter 0.2s; letter-spacing: 0.3px; }
.checkout-btn:hover { filter: brightness(1.08); }

/* ADMIN */
.admin-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
.admin-stat { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px 18px; }
.admin-stat-label { font-family: 'Space Mono', monospace; font-size: 0.58rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 6px; }
.admin-stat-value { font-family: 'Syne', sans-serif; font-size: 1.5rem; font-weight: 800; color: var(--accent); }
.admin-table { background: var(--card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
.admin-table-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 80px; padding: 12px 20px; background: rgba(0,229,195,0.05); border-bottom: 1px solid var(--border); font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; }
.admin-table-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 80px; padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); align-items: center; font-size: 0.85rem; transition: background 0.15s; }
.admin-table-row:hover { background: rgba(255,255,255,0.02); }
.admin-table-row:last-child { border-bottom: none; }
.admin-row-name { font-weight: 600; }
.admin-row-buyer { color: var(--muted); font-size: 0.78rem; margin-top: 2px; }
.admin-row-qty { font-family: 'Space Mono', monospace; font-size: 0.82rem; }
.admin-row-price { font-family: 'Space Mono', monospace; color: var(--accent2); }
.admin-row-total { font-family: 'Space Mono', monospace; color: var(--accent); font-weight: 700; }
.admin-remove-btn { background: none; border: 1px solid rgba(255,107,53,0.25); color: rgba(255,107,53,0.7); font-family: 'Space Mono', monospace; font-size: 0.62rem; padding: 4px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
.admin-remove-btn:hover { background: rgba(255,107,53,0.08); color: var(--warn); border-color: var(--warn); }
.admin-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
.admin-action-btn { font-family: 'Space Mono', monospace; font-size: 0.7rem; padding: 9px 18px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--text); cursor: pointer; transition: all 0.2s; }
.admin-action-btn:hover { border-color: rgba(0,229,195,0.35); color: var(--accent); background: rgba(0,229,195,0.04); }
.admin-action-btn.danger { border-color: rgba(255,107,53,0.3); color: var(--warn); }
.admin-action-btn.danger:hover { background: rgba(255,107,53,0.06); }

/* MODAL */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 200; display: flex; align-items: flex-end; justify-content: center; backdrop-filter: blur(4px); }
.modal-overlay.center { align-items: center; }
.modal { background: #0a1219; border: 1px solid var(--border); border-radius: 20px 20px 0 0; padding: 28px 24px; width: 100%; max-width: 480px; animation: slideIn 0.25s ease forwards; }
.modal.center-modal { border-radius: 20px; max-width: 400px; margin: 16px; }
.modal-title { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.modal-sub { font-size: 0.8rem; color: var(--muted); margin-bottom: 22px; }
.modal-label { font-family: 'Space Mono', monospace; font-size: 0.62rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 6px; display: block; }
.modal-input { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 9px; padding: 10px 14px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.9rem; outline: none; transition: border-color 0.2s; margin-bottom: 16px; }
.modal-input:focus { border-color: rgba(0,229,195,0.4); }
.qty-row { display: flex; align-items: center; gap: 16px; margin-bottom: 18px; }
.qty-big-btn { width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,0.03); color: var(--text); font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
.qty-big-btn:hover { border-color: rgba(0,229,195,0.4); color: var(--accent); }
.qty-big-num { font-family: 'Syne', sans-serif; font-size: 2rem; font-weight: 800; color: var(--text); flex: 1; text-align: center; }
.price-preview { background: rgba(0,229,195,0.05); border: 1px solid rgba(0,229,195,0.15); border-radius: 10px; padding: 14px 16px; margin-bottom: 18px; display: flex; justify-content: space-between; align-items: center; }
.price-preview-label { font-size: 0.82rem; color: var(--muted); }
.price-preview-value { font-family: 'Space Mono', monospace; font-size: 0.95rem; font-weight: 700; color: var(--accent); }
.modal-confirm-btn { width: 100%; padding: 13px; border-radius: 11px; border: none; background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #050a0e; font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 800; cursor: pointer; transition: filter 0.2s; letter-spacing: 0.3px; }
.modal-confirm-btn:hover:not(:disabled) { filter: brightness(1.08); }
.modal-confirm-btn:disabled { opacity: 0.3; cursor: not-allowed; }
.modal-cancel-btn { width: 100%; padding: 11px; border-radius: 11px; border: 1px solid var(--border); background: transparent; color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; margin-top: 8px; }
.modal-cancel-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }

/* TOAST */
.toast { position: fixed; top: 76px; left: 50%; transform: translateX(-50%); padding: 10px 20px; border-radius: 10px; font-size: 0.82rem; font-family: 'DM Sans', sans-serif; z-index: 999; box-shadow: 0 8px 24px rgba(0,0,0,0.5); animation: fadeUp 0.25s ease forwards; pointer-events: none; white-space: nowrap; }
.toast.success { background: rgba(0,229,195,0.12); border: 1px solid rgba(0,229,195,0.3); color: var(--accent); }
.toast.error { background: rgba(255,80,60,0.12); border: 1px solid rgba(255,80,60,0.3); color: #ff6b5b; }
.toast.info { background: rgba(0,168,255,0.12); border: 1px solid rgba(0,168,255,0.3); color: var(--accent2); }

/* CHECKOUT MODAL */
.checkout-modal { background: #0a1219; border: 1px solid var(--border); border-radius: 20px 20px 0 0; padding: 28px 24px 32px; width: 100%; max-width: 520px; animation: slideIn 0.25s ease forwards; max-height: 90vh; overflow-y: auto; }
.checkout-modal::-webkit-scrollbar { width: 3px; }
.checkout-modal::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
.checkout-section { margin-bottom: 22px; }
.checkout-section-title { font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
.input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.input-group { margin-bottom: 12px; }
.input-group label { display: block; font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 5px; }
.input-group input { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 9px; padding: 10px 14px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.88rem; outline: none; transition: border-color 0.2s; box-sizing: border-box; }
.input-group input:focus { border-color: rgba(0,229,195,0.4); }
.input-group input.error { border-color: rgba(255,107,53,0.5); }
.input-group input::placeholder { color: var(--muted); }
.freight-box { border-radius: 11px; padding: 14px 16px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.freight-box.free { background: rgba(0,229,195,0.06); border: 1px solid rgba(0,229,195,0.2); }
.freight-box.paid { background: rgba(255,107,53,0.06); border: 1px solid rgba(255,107,53,0.2); }
.freight-label { font-size: 0.82rem; }
.freight-label strong { display: block; font-family: 'Syne', sans-serif; font-size: 0.9rem; }
.freight-label small { color: var(--muted); font-size: 0.74rem; }
.freight-value { font-family: 'Space Mono', monospace; font-size: 1rem; font-weight: 700; }
.freight-value.free { color: var(--accent); }
.freight-value.paid { color: var(--warn); }
.order-total-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0 4px; border-top: 1px solid var(--border); margin-top: 6px; }
.order-total-label { font-size: 0.88rem; color: var(--muted); }
.order-total-value { font-family: 'Syne', sans-serif; font-size: 1.5rem; font-weight: 800; color: var(--accent); }

@media (max-width: 768px) {
  .app { grid-template-columns: 1fr; }
  aside { position: relative; top: auto; height: auto; border-right: none; border-bottom: 1px solid var(--border); flex-direction: row; flex-wrap: wrap; gap: 8px; padding: 14px; }
  main { padding: 20px 16px; }
  .products-grid { grid-template-columns: 1fr; }
  nav { padding: 0 16px; }
  .admin-grid { grid-template-columns: 1fr 1fr; }
  .admin-table-header, .admin-table-row { grid-template-columns: 2fr 1fr 1fr; }
  .admin-table-header > *:nth-child(4), .admin-table-row > *:nth-child(4) { display: none; }
  .calc-body { grid-template-columns: 1fr !important; }
}
/* CALCULATOR */
.calc-body { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; align-items: start; }
.calc-card { background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 16px; }
.calc-card:last-child { margin-bottom: 0; }
.calc-card-title { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 18px; }
.calc-label { font-size: 0.77rem; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
.calc-search-wrap { position: relative; }
.calc-input { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 0.88rem; padding: 11px 16px; outline: none; transition: border-color 0.2s; box-sizing: border-box; font-family: 'DM Sans', sans-serif; }
.calc-input:focus { border-color: rgba(0,229,195,0.4); }
.calc-dropdown { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background: #0e1822; border: 1px solid var(--border); border-radius: 10px; z-index: 200; max-height: 200px; overflow-y: auto; box-shadow: 0 12px 32px rgba(0,0,0,0.4); }
.calc-drop-item { padding: 10px 14px; cursor: pointer; font-size: 0.85rem; color: #a8bfc9; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.04); transition: background 0.15s; }
.calc-drop-item:last-child { border-bottom: none; }
.calc-drop-item:hover { background: rgba(0,229,195,0.07); color: var(--text); }
.calc-drop-item em { font-style: normal; color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.62rem; }
.calc-chip-selected { display: flex; align-items: center; gap: 10px; margin-top: 10px; background: rgba(0,229,195,0.07); border: 1px solid rgba(0,229,195,0.2); border-radius: 9px; padding: 9px 13px; }
.calc-chip-name { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.88rem; color: var(--text); flex: 1; }
.calc-chip-cat { font-family: 'Space Mono', monospace; font-size: 0.62rem; color: var(--muted); }
.calc-chip-clear { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1.2rem; line-height: 1; padding: 0; transition: color 0.2s; }
.calc-chip-clear:hover { color: var(--text); }
.chips-grid { display: flex; flex-wrap: wrap; gap: 7px; margin-bottom: 10px; }
.calc-chip-btn { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px; color: #a8bfc9; font-family: 'Space Mono', monospace; font-size: 0.7rem; padding: 7px 12px; cursor: pointer; transition: all 0.18s; white-space: nowrap; }
.calc-chip-btn:hover { border-color: rgba(0,229,195,0.3); color: var(--text); }
.calc-chip-btn.active { background: rgba(0,229,195,0.08); border-color: rgba(0,229,195,0.35); color: var(--accent); }
.calc-manual-wrap { display: flex; gap: 7px; align-items: center; margin-top: 4px; }
.calc-manual-input { flex: 1; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.85rem; padding: 9px 12px; outline: none; transition: border-color 0.2s; font-family: 'Space Mono', monospace; }
.calc-manual-input:focus { border-color: rgba(0,229,195,0.4); }
.calc-manual-unit { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--muted); background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 7px; padding: 9px 11px; white-space: nowrap; }
.calc-result-row { display: flex; justify-content: space-between; align-items: baseline; padding: 11px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
.calc-result-row:last-child { border-bottom: none; }
.calc-result-label { font-size: 0.8rem; color: var(--muted); }
.calc-result-value { font-family: 'Space Mono', monospace; font-size: 0.85rem; color: var(--text); font-weight: 600; }
.calc-result-value.accent { color: var(--accent); font-size: 0.95rem; }
.calc-recon { margin-top: 18px; padding-top: 18px; border-top: 1px solid var(--border); }
.calc-recon-title { font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 12px; }
.calc-bac-row { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
.calc-bac-label { font-size: 0.77rem; color: var(--muted); white-space: nowrap; }
.calc-bac-input { width: 76px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 7px; color: var(--text); font-size: 0.85rem; padding: 7px 10px; outline: none; font-family: 'Space Mono', monospace; transition: border-color 0.2s; }
.calc-bac-input:focus { border-color: rgba(0,229,195,0.4); }
.calc-recon-result { background: rgba(0,229,195,0.04); border: 1px solid rgba(0,229,195,0.12); border-radius: 10px; padding: 14px 16px; }
.calc-recon-row { display: flex; justify-content: space-between; align-items: baseline; padding: 5px 0; font-size: 0.82rem; }
.calc-recon-key { color: var(--muted); }
.calc-recon-val { font-family: 'Space Mono', monospace; color: var(--accent); font-weight: 600; }
.calc-duration-bar { margin-top: 7px; height: 3px; background: rgba(255,255,255,0.06); border-radius: 3px; overflow: hidden; }
.calc-duration-fill { height: 100%; background: var(--accent); border-radius: 3px; transition: width 0.4s ease; }
.calc-placeholder { text-align: center; padding: 50px 20px; color: var(--muted); }
.calc-placeholder-icon { font-size: 2.2rem; opacity: 0.25; margin-bottom: 10px; }
.calc-placeholder-text { font-size: 0.85rem; }
.calc-topical-notice { background: rgba(255,160,50,0.06); border: 1px solid rgba(255,160,50,0.2); border-radius: 10px; padding: 14px 16px; font-size: 0.82rem; color: #a8bfc9; line-height: 1.7; margin-top: 10px; }

/* ESGOTADO */
.product-card.esgotado { opacity: 0.45; }
.esgotado-badge { position: absolute; top: 12px; right: 12px; background: rgba(255,60,60,0.15); border: 1px solid rgba(255,60,60,0.4); color: #ff5050; font-family: 'Space Mono', monospace; font-size: 0.6rem; font-weight: 700; letter-spacing: 1.5px; padding: 3px 9px; border-radius: 6px; }
.add-to-cart-btn:disabled { opacity: 0.35; cursor: not-allowed; border-color: var(--border); color: var(--muted); }
.vial-wrap { display: flex; justify-content: center; align-items: center; padding: 12px 0 6px; margin-bottom: 4px; }

/* ADMIN TABS */
.admin-tabs { display: flex; gap: 4px; margin-bottom: 24px; background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: 11px; padding: 4px; }
.admin-tab { flex: 1; text-align: center; padding: 9px 12px; border-radius: 8px; border: none; background: transparent; color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.68rem; cursor: pointer; transition: all 0.18s; letter-spacing: 0.5px; }
.admin-tab.active { background: rgba(0,229,195,0.1); color: var(--accent); border: 1px solid rgba(0,229,195,0.25); }

/* STOCK TABLE */
.stock-table { background: var(--card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
.stock-row { display: grid; grid-template-columns: 1fr auto auto auto; align-items: center; padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); gap: 16px; }
.stock-row:last-child { border-bottom: none; }
.stock-name { font-weight: 600; font-size: 0.88rem; }
.stock-sku { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); margin-top: 2px; }
.stock-qty { font-family: 'Space Mono', monospace; font-size: 1rem; font-weight: 700; min-width: 40px; text-align: center; }
.stock-qty.zero { color: #ff5050; }
.stock-qty.low { color: var(--warn); }
.stock-qty.ok { color: var(--accent); }
.stock-ctrl { display: flex; align-items: center; gap: 6px; }
.stock-btn { width: 30px; height: 30px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.03); color: var(--text); font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
.stock-btn:hover { border-color: rgba(0,229,195,0.4); color: var(--accent); }
.stock-input { width: 60px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'Space Mono', monospace; font-size: 0.85rem; padding: 6px 8px; outline: none; text-align: center; transition: border-color 0.2s; }
.stock-input:focus { border-color: rgba(0,229,195,0.4); }

/* PRODUCT FORM */
.prod-form { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 24px; margin-bottom: 20px; }
.prod-form-title { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700; margin-bottom: 20px; }
.prod-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.prod-form-group { display: flex; flex-direction: column; gap: 5px; }
.prod-form-group label { font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; }
.prod-form-group input, .prod-form-group select, .prod-form-group textarea { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 9px; padding: 10px 14px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.88rem; outline: none; transition: border-color 0.2s; }
.prod-form-group input:focus, .prod-form-group select:focus, .prod-form-group textarea:focus { border-color: rgba(0,229,195,0.4); }
.prod-form-group select option { background: #0a1219; }
.prod-form-group textarea { resize: vertical; min-height: 70px; }
.prod-form-full { grid-column: 1 / -1; }
.prod-list { background: var(--card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
.prod-list-row { display: grid; grid-template-columns: auto 1fr auto auto auto; align-items: center; padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); gap: 14px; }
.prod-list-row:last-child { border-bottom: none; }
.prod-list-sku { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--accent); background: rgba(0,229,195,0.07); border: 1px solid rgba(0,229,195,0.15); padding: 3px 8px; border-radius: 5px; white-space: nowrap; }
.prod-list-name { font-weight: 600; font-size: 0.88rem; }
.prod-list-cat { font-size: 0.72rem; color: var(--muted); margin-top: 2px; }
.prod-list-price { font-family: 'Space Mono', monospace; color: var(--accent2); font-size: 0.85rem; white-space: nowrap; }
.prod-edit-btn { background: none; border: 1px solid var(--border); color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.62rem; padding: 4px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
.prod-edit-btn:hover { border-color: rgba(0,229,195,0.35); color: var(--accent); }
.prod-del-btn { background: none; border: 1px solid rgba(255,107,53,0.25); color: rgba(255,107,53,0.7); font-family: 'Space Mono', monospace; font-size: 0.62rem; padding: 4px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
.prod-del-btn:hover { background: rgba(255,107,53,0.08); color: var(--warn); border-color: var(--warn); }
</style>
</head>
<body>
<div class="glow-bg"></div>
<div class="glow-bg2"></div>
<div id="root"></div>
<script type="text/babel">
const { useState, useMemo } = React;
const ADMIN_PASS = "157842";

const CATEGORIES = [
  { id: "all",          name: "Todos",               icon: "ðŸ§¬", color: "rgba(0,229,195,0.15)" },
  { id: "emagrecedores",name: "Emagrecedores",        icon: "ðŸ’‰", color: "rgba(0,229,195,0.15)" },
  { id: "beleza",       name: "Beleza & Pele",        icon: "âœ¨", color: "rgba(124,58,237,0.2)" },
  { id: "corpo",        name: "Corpo & Metabolismo",  icon: "ðŸ”¥", color: "rgba(255,107,53,0.15)" },
  { id: "longevidade",  name: "Longevidade",          icon: "âš¡", color: "rgba(0,168,255,0.15)" },
  { id: "libido",       name: "Libido",               icon: "ðŸ’†", color: "rgba(236,72,153,0.15)" },
  { id: "neuro",        name: "Neuro & Foco",         icon: "ðŸ§ ", color: "rgba(99,102,241,0.2)" },
];

const DEFAULT_PEPTIDES = [
  { id: "tirzepatida", sku: "TZ15",   name: "Tirzepatida 15mg",    desc: "Agonista dual GIP/GLP-1 para perda de peso avanÃ§ada",             category: "emagrecedores", price: 299 },
  { id: "retatrutida", sku: "RT15",   name: "Retatrutida 15mg",    desc: "Agonista triplo GIP/GLP-1/Glucagon de nova geraÃ§Ã£o",              category: "emagrecedores", price: 399 },
  { id: "ghkcu",       sku: "GHK50",  name: "GHK-Cu 50mg",         desc: "PeptÃ­deo cÃºprico para colÃ¡geno, pele e cabelo",                  category: "beleza",        price: 299 },
  { id: "glow",        sku: "GLOW70", name: "GLOW Blend 70mg",     desc: "BPC-157 + TB-500 + GHK-Cu â€” stack completo recuperaÃ§Ã£o e beleza", category: "beleza",        price: 699 },
  { id: "snap8",       sku: "SNAP10", name: "SNAP-8 10mg",         desc: "Botox natural, reduz linhas de expressÃ£o",                       category: "beleza",        price: 290 },
  { id: "tesamorelin", sku: "TSM5",   name: "Tesamorelin 5mg",     desc: "Queima de gordura visceral sem efeitos GLP-1",                   category: "corpo",         price: 299 },
  { id: "epithalon",   sku: "EPT10",  name: "Epithalon 10mg",      desc: "Longevidade celular, telÃ´meros, sono e energia",                 category: "longevidade",   price: 249 },
  { id: "pt141",       sku: "PT141",  name: "PT-141 10mg",         desc: "Modulador de libido masculino e feminino",                       category: "libido",        price: 280 },
  { id: "selank",      sku: "SLK5",   name: "Selank 5mg",          desc: "AnsiolÃ­tico peptÃ­dico, foco e clareza mental",                   category: "neuro",         price: 199 },
];

function loadProducts() {
  try { const s = localStorage.getItem("vg-products"); return s ? JSON.parse(s) : DEFAULT_PEPTIDES; } catch { return DEFAULT_PEPTIDES; }
}
function saveProducts(p) { localStorage.setItem("vg-products", JSON.stringify(p)); }

function loadStock() {
  try { return JSON.parse(localStorage.getItem("vg-stock") || "{}"); } catch { return {}; }
}
function saveStock(s) { localStorage.setItem("vg-stock", JSON.stringify(s)); }

// â”€â”€ persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// orders: [{ id, peptideId, buyerName, qty, createdAt }]
function loadOrders() {
  try { return JSON.parse(localStorage.getItem("vg-orders") || "[]"); } catch { return []; }
}
function saveOrders(orders) {
  localStorage.setItem("vg-orders", JSON.stringify(orders));
}

// â”€â”€ CALCULATOR DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CALC_PEP_DB = {
  tirzepatide:{ name:'Tirzepatida',  tags:['InjetÃ¡vel','GLP-1/GIP'] },
  retatrutide:{ name:'Retatrutida',  tags:['InjetÃ¡vel','GLP-1'] },
  ghkcu:      { name:'GHK-Cu',       tags:['InjetÃ¡vel','TÃ³pico','Pele'] },
  snap8:      { name:'SNAP-8',       tags:['TÃ³pico','Creme/SÃ©rum'] },
  tesamorelin:{ name:'Tesamorelin',  tags:['InjetÃ¡vel','GHRH'] },
  epithalon:  { name:'Epithalon',    tags:['InjetÃ¡vel','Longevidade'] },
  pt141:      { name:'PT-141',       tags:['InjetÃ¡vel','Libido'] },
  selank:     { name:'Selank',       tags:['Nasal','AnsiolÃ­tico'] },
  bpc157:     { name:'BPC-157',      tags:['InjetÃ¡vel','Reparo'] },
  tb500:      { name:'TB-500',       tags:['InjetÃ¡vel','SistÃªmico'] },
  semaglutide:{ name:'Semaglutida',  tags:['InjetÃ¡vel','GLP-1'] },
  ipamorelin: { name:'Ipamorelin',   tags:['InjetÃ¡vel','GH'] },
  cjc1295:    { name:'CJC-1295',     tags:['InjetÃ¡vel','GHRH'] },
  semax:      { name:'Semax',        tags:['Nasal','Cognitivo'] },
  aod9604:    { name:'AOD-9604',     tags:['InjetÃ¡vel','LipÃ³lise'] },
  motsc:      { name:'MOTS-c',       tags:['InjetÃ¡vel','Mitocondrial'] },
  humanin:    { name:'Humanin',      tags:['InjetÃ¡vel','Longevidade'] },
  foxo4dri:   { name:'FOXO4-DRI',    tags:['InjetÃ¡vel','SenolÃ­tico'] },
  thymosinA1: { name:'Timosina Î±1',  tags:['InjetÃ¡vel','Imunidade'] },
  mt2:        { name:'Melanotan II', tags:['InjetÃ¡vel','Melanocortina'] },
};

const CALC_DOSES = {
  bpc157:     { doses:[200,300,500,1000], freqs:[{l:'1x/dia',t:1},{l:'2x/dia',t:2},{l:'3x/dia',t:3}], dfi:1, vials:[2,5,10,60], unit:'mcg' },
  tb500:      { doses:[2000,5000],        freqs:[{l:'2x/sem',t:0.29},{l:'1x/sem',t:0.14},{l:'Quinzenal',t:0.07}], dfi:0, vials:[2,5,10,60], unit:'mcg' },
  ghkcu:      { doses:[1000,2000],        freqs:[{l:'1x/dia',t:1},{l:'2x/dia',t:2}], dfi:0, vials:[5,10,50,60], unit:'mcg' },
  snap8:      { topical:true, conc:'3â€“8%', veh:'creme/sÃ©rum' },
  semaglutide:{ doses:[250,500,1000,2400],freqs:[{l:'1x/sem',t:0.14}], dfi:0, vials:[1,2.4], unit:'mcg' },
  tirzepatide:{ doses:[2500,5000,10000,15000],freqs:[{l:'1x/sem',t:0.14}], dfi:0, vials:[2.5,5,10,15], unit:'mcg' },
  tesamorelin:{ doses:[1000,2000],        freqs:[{l:'1x/dia',t:1}], dfi:0, vials:[2,5], unit:'mcg' },
  retatrutide:{ doses:[2000,4000,8000,12000],freqs:[{l:'1x/sem',t:0.14}], dfi:0, vials:[2,5,12], unit:'mcg' },
  ipamorelin: { doses:[100,200,300],      freqs:[{l:'1x/dia',t:1},{l:'2x/dia',t:2},{l:'3x/dia',t:3}], dfi:1, vials:[2,5], unit:'mcg' },
  cjc1295:    { doses:[100,200,300],      freqs:[{l:'3x/dia',t:3},{l:'2x/dia',t:2},{l:'1x/sem (DAC)',t:0.14}], dfi:0, vials:[2,5], unit:'mcg' },
  epithalon:  { doses:[5000,10000],       freqs:[{l:'1x/dia (ciclo)',t:1},{l:'2x/dia (ciclo)',t:2}], dfi:0, vials:[10,20,60], unit:'mcg' },
  pt141:      { doses:[1000,2000],        freqs:[{l:'Pontual (uso)',t:1},{l:'2x/sem',t:0.29}], dfi:0, vials:[2,10], unit:'mcg' },
  selank:     { doses:[250,500,1000],     freqs:[{l:'1x/dia',t:1},{l:'2x/dia',t:2}], dfi:1, vials:[5,10,60], unit:'mcg', nasal:true },
  semax:      { doses:[200,300,600],      freqs:[{l:'1x/dia',t:1},{l:'2x/dia',t:2}], dfi:1, vials:[2,5], unit:'mcg', nasal:true },
  aod9604:    { doses:[300,500],          freqs:[{l:'1x/dia',t:1},{l:'2x/dia',t:2}], dfi:0, vials:[2,5], unit:'mcg' },
  motsc:      { doses:[5000,10000],       freqs:[{l:'1x/sem',t:0.14},{l:'2x/sem',t:0.29}], dfi:0, vials:[5,10,60], unit:'mcg' },
  humanin:    { doses:[2000,5000,10000],  freqs:[{l:'1x/sem',t:0.14},{l:'2x/sem',t:0.29}], dfi:0, vials:[5,10,60], unit:'mcg' },
  foxo4dri:   { doses:[1000,3000,5000],   freqs:[{l:'3x/sem (ciclo)',t:0.43}], dfi:0, vials:[5,10,60], unit:'mcg' },
  thymosinA1: { doses:[1600,3200],        freqs:[{l:'2x/sem',t:0.29},{l:'3x/sem',t:0.43}], dfi:0, vials:[5], unit:'mcg' },
  mt2:        { doses:[250,500,1000],     freqs:[{l:'Carregamento diÃ¡rio',t:1},{l:'ManutenÃ§Ã£o 2x/sem',t:0.29}], dfi:0, vials:[5,10,60], unit:'mcg' },
};

function formatDose(val, unit) {
  unit = unit || 'mcg';
  if (unit === 'mcg') {
    if (val >= 1000) return (val/1000).toFixed(val%1000===0?0:2) + ' mg';
    return val + ' mcg';
  }
  return val + ' ' + unit;
}

function VialSVG({ name, dose, sku, color }) {
  // Parse product name: "Tirzepatida 15mg" -> ["TIRZEPATIDA", "15mg"]
  const parts = name ? name.split(/(\d+\s*m[gcl]+)/i) : ["PRODUTO",""];
  const title = (parts[0]||name).trim().toUpperCase().slice(0, 14);
  const doseStr = dose || (parts[1]||"").trim();
  const skuStr = sku || "";
  const teal = "#00e5c3";
  const labelBg = "#0a1219";
  const glassDark = "#0d1c2a";
  const glassLight = "#1a3040";
  const capColor = "#1c2e3a";
  const rubberColor = "#0f1d28";
  const shimmer = "rgba(255,255,255,0.08)";

  return (
    <svg viewBox="0 0 110 220" width="88" height="176" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id={`gb_${sku}`} x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stopColor={glassDark} />
          <stop offset="18%" stopColor={glassLight} />
          <stop offset="50%" stopColor="#22404f" />
          <stop offset="82%" stopColor={glassLight} />
          <stop offset="100%" stopColor={glassDark} />
        </linearGradient>
        <linearGradient id={`gcap_${sku}`} x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stopColor="#0a1821" />
          <stop offset="40%" stopColor="#1f3545" />
          <stop offset="100%" stopColor="#0a1821" />
        </linearGradient>
        <linearGradient id={`grim_${sku}`} x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stopColor="#0e2030" />
          <stop offset="45%" stopColor={teal} stopOpacity="0.8" />
          <stop offset="100%" stopColor="#0e2030" />
        </linearGradient>
        <linearGradient id={`gbot_${sku}`} x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stopColor="#1a3040" />
          <stop offset="100%" stopColor="#0a1219" />
        </linearGradient>
        <clipPath id={`cvial_${sku}`}>
          <rect x="18" y="36" width="74" height="170" rx="9" />
        </clipPath>
        <filter id={`glow_${sku}`}>
          <feGaussianBlur stdDeviation="1.5" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>

      {/* === CAP AREA === */}
      {/* Crimped aluminum rim */}
      <rect x="24" y="8" width="62" height="8" rx="3" fill={`url(#gcap_${sku})`} />
      <rect x="22" y="14" width="66" height="5" rx="2" fill={`url(#grim_${sku})`} />
      {/* Rubber stopper */}
      <rect x="26" y="19" width="58" height="18" rx="4" fill={rubberColor} />
      <rect x="30" y="21" width="50" height="3" rx="1.5" fill="rgba(255,255,255,0.05)" />
      {/* Top shimmer line */}
      <rect x="22" y="16" width="66" height="1" rx="0.5" fill="rgba(0,229,195,0.5)" />

      {/* === GLASS BODY === */}
      <rect x="18" y="36" width="74" height="170" rx="9" fill={`url(#gb_${sku})`} />

      {/* Left glass edge shine */}
      <rect x="18" y="40" width="5" height="162" rx="2.5" fill="rgba(255,255,255,0.06)" clipPath={`url(#cvial_${sku})`} />
      {/* Right glass edge shine */}
      <rect x="87" y="40" width="5" height="162" rx="2.5" fill="rgba(255,255,255,0.04)" clipPath={`url(#cvial_${sku})`} />
      {/* Center shimmer */}
      <rect x="48" y="40" width="8" height="162" fill="rgba(255,255,255,0.025)" clipPath={`url(#cvial_${sku})`} />

      {/* === LABEL === */}
      <g clipPath={`url(#cvial_${sku})`}>
        {/* Label background */}
        <rect x="18" y="64" width="74" height="112" fill={labelBg} />
        {/* Label top teal line */}
        <rect x="18" y="64" width="74" height="1.5" fill={teal} opacity="0.7" />
        {/* Label bottom dashed separator */}
        <line x1="22" y1="148" x2="88" y2="148" stroke={teal} strokeWidth="0.6" strokeDasharray="3,2" opacity="0.4" />

        {/* VANGUARD LABS LOGO AREA */}
        {/* V diamond icon */}
        <polygon points="27,74 33,69 39,74 33,79" fill="none" stroke={teal} strokeWidth="1.2" />
        <line x1="33" y1="69" x2="33" y2="79" stroke={teal} strokeWidth="0.8" opacity="0.5" />
        <line x1="27" y1="74" x2="39" y2="74" stroke={teal} strokeWidth="0.8" opacity="0.5" />

        {/* VANGUARD LABS text */}
        <text x="43" y="77" fontFamily="'Space Mono', monospace" fontSize="5.5" fill="#a8bfc9" letterSpacing="0.8"
          fontWeight="600">VANGUARD LABS</text>

        {/* Divider */}
        <line x1="22" y1="83" x2="88" y2="83" stroke="rgba(255,255,255,0.08)" strokeWidth="0.5" />

        {/* PRODUCT NAME - big */}
        <text x="24" y="101" fontFamily="'Syne', sans-serif" fontSize={title.length > 10 ? "10" : "12"}
          fill="white" fontWeight="800" letterSpacing="0.3">{title}</text>

        {/* DOSE - teal */}
        <text x="24" y="115" fontFamily="'Space Mono', monospace" fontSize="8.5"
          fill={teal} fontWeight="700">{doseStr}</text>

        {/* Divider */}
        <line x1="22" y1="120" x2="88" y2="120" stroke="rgba(255,255,255,0.06)" strokeWidth="0.5" />

        {/* 99% Purity */}
        <text x="24" y="130" fontFamily="'DM Sans', sans-serif" fontSize="6" fill="#8099aa" letterSpacing="0.2">99% Purity</text>
        {/* Research Use Only */}
        <text x="24" y="139" fontFamily="'DM Sans', sans-serif" fontSize="6" fill="#8099aa" letterSpacing="0.2">Research Use Only</text>

        {/* SKU */}
        <text x="24" y="157" fontFamily="'Space Mono', monospace" fontSize="5.5" fill="#8099aa">SKU: {skuStr}</text>

        {/* Bottom right teal decoration - circuit line */}
        <line x1="65" y1="158" x2="72" y2="158" stroke={teal} strokeWidth="1.2" opacity="0.6" />
        <rect x="74" y="155" width="12" height="4" rx="1" fill={teal} opacity="0.25" />
        <rect x="74" y="156.5" width="12" height="1" rx="0.5" fill={teal} opacity="0.7" />

        {/* Label bottom teal line */}
        <rect x="18" y="174.5" width="74" height="1.5" fill={teal} opacity="0.15" />
      </g>

      {/* === GLASS OVERLAYS (on top of label) === */}
      {/* Left glass reflection strip */}
      <rect x="19" y="36" width="3" height="168" rx="1.5" fill="rgba(255,255,255,0.07)" clipPath={`url(#cvial_${sku})`} />
      {/* Top glass reflection */}
      <rect x="18" y="36" width="74" height="8" rx="4" fill="rgba(255,255,255,0.04)" clipPath={`url(#cvial_${sku})`} />

      {/* === BOTTOM === */}
      <rect x="18" y="196" width="74" height="10" rx="0" fill={`url(#gbot_${sku})`} clipPath={`url(#cvial_${sku})`} />
      <ellipse cx="55" cy="206" rx="37" ry="5" fill={glassDark} />
      <ellipse cx="55" cy="206" rx="20" ry="2" fill="rgba(0,229,195,0.06)" />

      {/* === SHADOW === */}
      <ellipse cx="55" cy="213" rx="32" ry="5" fill="rgba(0,0,0,0.45)" />
    </svg>
  );
}


  const { useState: us, useRef: ur } = React;
  const [search, setSearch] = us('');
  const [dropOpen, setDropOpen] = us(false);
  const [selId, setSelId] = us(null);
  const [dose, setDose] = us(null);
  const [freq, setFreq] = us(null);
  const [vial, setVial] = us(null);
  const [bacMl, setBacMl] = us(2);
  const [manualDose, setManualDose] = us('');
  const [manualVial, setManualVial] = us('');
  const wrapRef = ur(null);

  const selPep = selId ? CALC_PEP_DB[selId] : null;
  const db     = selId ? CALC_DOSES[selId] : null;

  const allPeps = Object.entries(CALC_PEP_DB);
  const filtered = search.trim().length > 0
    ? allPeps.filter(([id, p]) => p.name.toLowerCase().includes(search.toLowerCase()) || (p.tags||[]).join(' ').toLowerCase().includes(search.toLowerCase()))
    : allPeps;

  function selectPep(id) {
    setSelId(id);
    setSearch('');
    setDropOpen(false);
    setDose(null);
    setFreq(null);
    setManualDose('');
    setManualVial('');
    const d = CALC_DOSES[id];
    if (d && !d.topical) {
      setFreq(d.freqs[d.dfi]);
      setVial(d.vials[0]);
    } else {
      setVial(null);
    }
  }

  function clearSel() {
    setSelId(null); setSearch(''); setDose(null); setFreq(null); setVial(null); setManualDose(''); setManualVial('');
  }

  // Results calc
  let results = null;
  let recon = null;
  if (dose && freq && !db?.topical) {
    const unit = db?.unit || 'mcg';
    const daily = dose * freq.t;
    results = {
      doseAppl: formatDose(dose, unit),
      freqLabel: freq.l,
      daily: formatDose(daily, unit),
      weekly: formatDose(daily * 7, unit),
      monthly: formatDose(daily * 30, unit),
    };
    if (vial) {
      const vialMcg = vial * 1000;
      const concMcgMl = vialMcg / bacMl;
      const volMl = dose / concMcgMl;
      const volUl = volMl * 1000;
      const ui = volMl * 100;
      const daysPerVial = vialMcg / (dose * freq.t);
      recon = {
        conc: concMcgMl >= 1000 ? (concMcgMl/1000).toFixed(2)+' mg/mL' : concMcgMl.toFixed(0)+' mcg/mL',
        vol: volUl >= 1000 ? volMl.toFixed(3)+' mL' : volUl.toFixed(1)+' ÂµL',
        ui: ui.toFixed(1)+' UI',
        duration: daysPerVial >= 1 ? Math.round(daysPerVial)+' dias' : Math.round(daysPerVial*24)+' horas',
        barPct: Math.min(100, (daysPerVial/90)*100),
      };
    }
  }

  return (
    <div className="calc-body">
      {/* LEFT */}
      <div>
        {/* Peptide selector */}
        <div className="calc-card">
          <div className="calc-card-title">ðŸ”¬ PeptÃ­deo</div>
          <div className="calc-search-wrap" ref={wrapRef}>
            <input className="calc-input" placeholder="Buscar peptÃ­deo..."
              value={search}
              onChange={e=>{ setSearch(e.target.value); setDropOpen(true); }}
              onFocus={()=>setDropOpen(true)}
            />
            {dropOpen && (
              <div className="calc-dropdown">
                {filtered.length === 0
                  ? <div className="calc-drop-item" style={{color:'var(--muted)'}}>Nenhum resultado</div>
                  : filtered.slice(0,14).map(([id, p]) => (
                    <div key={id} className="calc-drop-item" onMouseDown={()=>selectPep(id)}>
                      <span>{p.name}</span>
                      <em>{(p.tags||[])[0]||''}</em>
                    </div>
                  ))
                }
              </div>
            )}
          </div>
          {selPep && (
            <div className="calc-chip-selected">
              <div>
                <div className="calc-chip-name">{selPep.name}</div>
                <div className="calc-chip-cat">{(selPep.tags||[]).join(' Â· ')}</div>
              </div>
              <button className="calc-chip-clear" onClick={clearSel}>Ã—</button>
            </div>
          )}
        </div>

        {/* Dose */}
        {selId && db && !db.topical && (
          <div className="calc-card">
            <div className="calc-card-title">ðŸ’‰ Dose por AplicaÃ§Ã£o</div>
            <div className="calc-label">Doses mais comuns:</div>
            <div className="chips-grid">
              {db.doses.map(d => (
                <button key={d} className={`calc-chip-btn ${dose===d&&!manualDose?'active':''}`}
                  onClick={()=>{ setDose(d); setManualDose(''); }}>
                  {formatDose(d, db.unit)}
                </button>
              ))}
            </div>
            <div className="calc-manual-wrap">
              <input type="number" className="calc-manual-input" placeholder="Outra dose..."
                value={manualDose} min="0"
                onChange={e=>{ setManualDose(e.target.value); const v=parseFloat(e.target.value); if(!isNaN(v)&&v>0) setDose(v); }}
              />
              <div className="calc-manual-unit">{db.unit||'mcg'}</div>
            </div>
          </div>
        )}

        {/* Topical notice */}
        {selId && db && db.topical && (
          <div className="calc-topical-notice">
            ðŸ§´ <strong>PeptÃ­deo tÃ³pico.</strong> ConcentraÃ§Ã£o tÃ­pica: <strong>{db.conc}</strong>. NÃ£o hÃ¡ dose em mcg por aplicaÃ§Ã£o â€” use na seÃ§Ã£o de reconstituiÃ§Ã£o para calcular a concentraÃ§Ã£o do seu veÃ­culo cosmÃ©tico <em>({db.veh})</em>.
          </div>
        )}

        {/* Freq */}
        {selId && db && !db.topical && dose && (
          <div className="calc-card">
            <div className="calc-card-title">â±ï¸ FrequÃªncia</div>
            <div className="chips-grid">
              {db.freqs.map((f, i) => (
                <button key={i} className={`calc-chip-btn ${freq?.l===f.l?'active':''}`}
                  onClick={()=>setFreq(f)}>
                  {f.l}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>

      {/* RIGHT */}
      <div>
        {!results && (
          <div className="calc-card">
            <div className="calc-placeholder">
              <div className="calc-placeholder-icon">ðŸ§®</div>
              <div className="calc-placeholder-text">Selecione um peptÃ­deo e configure a dose para ver os cÃ¡lculos</div>
            </div>
          </div>
        )}

        {results && (
          <div className="calc-card">
            <div className="calc-card-title">ðŸ“Š Resultado</div>

            <div className="calc-result-row">
              <span className="calc-result-label">Dose por aplicaÃ§Ã£o</span>
              <span className="calc-result-value accent">{results.doseAppl}</span>
            </div>
            <div className="calc-result-row">
              <span className="calc-result-label">FrequÃªncia</span>
              <span className="calc-result-value">{results.freqLabel}</span>
            </div>
            <div className="calc-result-row">
              <span className="calc-result-label">Dose diÃ¡ria total</span>
              <span className="calc-result-value">{results.daily}</span>
            </div>
            <div className="calc-result-row">
              <span className="calc-result-label">Dose semanal total</span>
              <span className="calc-result-value">{results.weekly}</span>
            </div>
            <div className="calc-result-row">
              <span className="calc-result-label">Dose mensal (30 dias)</span>
              <span className="calc-result-value">{results.monthly}</span>
            </div>

            {/* Reconstitution */}
            <div className="calc-recon">
              <div className="calc-recon-title">ðŸ’§ ReconstituiÃ§Ã£o com Ãgua BacteriostÃ¡tica</div>

              <div className="calc-label">Tamanho do frasco:</div>
              <div className="chips-grid">
                {db.vials.map(v => (
                  <button key={v} className={`calc-chip-btn ${vial===v&&!manualVial?'active':''}`}
                    onClick={()=>{ setVial(v); setManualVial(''); }}>
                    {v} mg
                  </button>
                ))}
              </div>
              <div className="calc-manual-wrap" style={{marginBottom:12}}>
                <input type="number" className="calc-manual-input" placeholder="Outro tamanho..."
                  value={manualVial} min="0" step="0.5"
                  onChange={e=>{ setManualVial(e.target.value); const v=parseFloat(e.target.value); if(!isNaN(v)&&v>0) setVial(v); }}
                />
                <div className="calc-manual-unit">mg</div>
              </div>

              <div className="calc-bac-row">
                <span className="calc-bac-label">Volume de BAC water:</span>
                <input type="number" className="calc-bac-input" value={bacMl} min="0.5" max="10" step="0.5"
                  onChange={e=>setBacMl(parseFloat(e.target.value)||2)} />
                <span className="calc-manual-unit">mL</span>
              </div>

              {recon && (
                <div className="calc-recon-result">
                  <div className="calc-recon-row">
                    <span className="calc-recon-key">ConcentraÃ§Ã£o</span>
                    <span className="calc-recon-val">{recon.conc}</span>
                  </div>
                  <div className="calc-recon-row">
                    <span className="calc-recon-key">Volume por dose</span>
                    <span className="calc-recon-val">{recon.vol}</span>
                  </div>
                  <div className="calc-recon-row">
                    <span className="calc-recon-key">Unidades na seringa (UI)</span>
                    <span className="calc-recon-val">{recon.ui}</span>
                  </div>
                  <div className="calc-recon-row" style={{paddingTop:8,borderTop:'1px solid rgba(255,255,255,0.06)',marginTop:4}}>
                    <span className="calc-recon-key">DuraÃ§Ã£o do frasco</span>
                    <span className="calc-recon-val">{recon.duration}</span>
                  </div>
                  <div className="calc-duration-bar">
                    <div className="calc-duration-fill" style={{width: recon.barPct+'%'}}></div>
                  </div>
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

function App() {
  const [orders, setOrders] = useState(loadOrders);
  const [products, setProducts] = useState(loadProducts);
  const [stock, setStock] = useState(loadStock);
  const [view, setView]     = useState("catalog");
  const [activeCat, setActiveCat] = useState("all");
  const [myName, setMyName] = useState(() => localStorage.getItem("vg-nome") || "");
  const [toast, setToast]   = useState(null);
  const [modal, setModal]   = useState(null);
  const [formQty, setFormQty] = useState(1);
  const [formName, setFormName] = useState("");
  const [adminUnlocked, setAdminUnlocked] = useState(false);
  const [adminTab, setAdminTab] = useState("pedidos");
  const [prodForm, setProdForm] = useState(null); // null = fechado, {} = novo, {id} = editando
  const [checkoutOpen, setCheckoutOpen] = useState(false);
  const [checkout, setCheckout] = useState(() => {
    try { return JSON.parse(localStorage.getItem('vg-checkout') || 'null') || { nomeCompleto:'', cpf:'', telefone:'', email:'', cep:'', estado:'', cidade:'', bairro:'', rua:'', numero:'', complemento:'', pagamento:'', observacoes:'' }; } catch { return { nomeCompleto:'', cpf:'', telefone:'', email:'', cep:'', estado:'', cidade:'', bairro:'', rua:'', numero:'', complemento:'', pagamento:'', observacoes:'' }; }
  });
  const [checkoutErrors, setCheckoutErrors] = useState({});
  const [disclaimer, setDisclaimer] = useState(false);

  function persistOrders(o) { setOrders(o); saveOrders(o); }
  function persistProducts(p) { setProducts(p); saveProducts(p); }
  function persistStock(s) { setStock(s); saveStock(s); }

  // Freight calculation
  function calcFreight(estado, total) {
    if (total >= 1000) return { value: 0, label: 'Frete grÃ¡tis', reason: 'Pedido acima de R$ 1.000' };
    if (estado === 'SP' && total >= 600) return { value: 0, label: 'Frete grÃ¡tis', reason: 'SP + pedido acima de R$ 600 â€¢ Entrega no mesmo dia ou dia seguinte' };
    if (estado === 'SP') return { value: 60, label: 'R$ 60,00', reason: 'Via transportadora â€¢ Entrega no mesmo dia ou dia seguinte' };
    return { value: 60, label: 'R$ 60,00', reason: 'Via transportadora' };
  }

  async function fetchCep(cep) {
    const clean = cep.replace(/\D/g, '');
    if (clean.length !== 8) return;
    try {
      const r = await fetch(`https://viacep.com.br/ws/${clean}/json/`);
      const d = await r.json();
      if (!d.erro) {
        setCheckout(c => ({ ...c, estado: d.uf, cidade: d.localidade, bairro: d.bairro, rua: d.logradouro }));
      }
    } catch {}
  }

  function validateCheckout() {
    const errs = {};
    if (!checkout.nomeCompleto.trim()) errs.nomeCompleto = true;
    if (!/^\d{11}$/.test(checkout.cpf.replace(/\D/g,''))) errs.cpf = true;
    if (!checkout.telefone.trim()) errs.telefone = true;
    if (!checkout.email.trim() || !checkout.email.includes('@')) errs.email = true;
    if (!/^\d{8}$/.test(checkout.cep.replace(/\D/g,''))) errs.cep = true;
    if (!checkout.rua.trim()) errs.rua = true;
    if (!checkout.numero.trim()) errs.numero = true;
    if (!checkout.cidade.trim()) errs.cidade = true;
    if (!checkout.estado.trim()) errs.estado = true;
    if (!checkout.pagamento) errs.pagamento = true;
    setCheckoutErrors(errs);
    return Object.keys(errs).length === 0;
  }

  function saveCheckoutData(data) {
    setCheckout(data);
    localStorage.setItem('vg-checkout', JSON.stringify(data));
  }

  function updateCheckout(field, value) {
    const updated = { ...checkout, [field]: value };
    saveCheckoutData(updated);
  }

  function sendToWhatsApp() {
    if (!validateCheckout()) { showToast("Preencha todos os campos obrigatÃ³rios", "error"); return; }
    if (!disclaimer) { showToast("Confirme o aviso legal para prosseguir", "error"); return; }
    const freight = calcFreight(checkout.estado, myTotal);
    const totalFinal = myTotal + freight.value;
    const itens = myOrders.map(o => {
      const p = products.find(x => x.id === o.peptideId);
      return `â€¢ ${p.name} Ã—${o.qty} = R$ ${(p.price * o.qty).toLocaleString('pt-BR')}`;
    }).join('\n');
    const pagamentoLabel = checkout.pagamento === 'pix' ? 'PIX (Ã  vista)' : checkout.pagamento === '2x' ? 'CartÃ£o 2x (juros Mercado Pago)' : 'CartÃ£o 3x (juros Mercado Pago)';
    const msg =
`ðŸ§¬ *PEDIDO VANGUARD PEPTIDES*

ðŸ‘¤ *Dados do Cliente*
Nome: ${checkout.nomeCompleto}
CPF: ${checkout.cpf}
Telefone: ${checkout.telefone}
E-mail: ${checkout.email}

ðŸ“¦ *EndereÃ§o de Entrega*
${checkout.rua}, ${checkout.numero}${checkout.complemento ? ' â€” '+checkout.complemento : ''}
${checkout.bairro} â€” ${checkout.cidade}/${checkout.estado}
CEP: ${checkout.cep}

ðŸ›’ *Itens*
${itens}

ðŸ’³ *Pagamento:* ${pagamentoLabel}

ðŸ’° *Resumo*
Subtotal: R$ ${myTotal.toLocaleString('pt-BR')}
Frete: ${freight.value === 0 ? 'GRÃTIS' : 'R$ 60,00'} (${freight.reason})
*Total: R$ ${totalFinal.toLocaleString('pt-BR')}*${checkout.observacoes ? '\n\nðŸ“ *Obs:* ' + checkout.observacoes : ''}`;
    window.open(`https://wa.me/447418333521?text=${encodeURIComponent(msg)}`, '_blank');
    // Limpar carrinho do cliente apÃ³s envio
    persistOrders(orders.filter(o => o.buyerName.toLowerCase() !== myName.toLowerCase()));
    setCheckoutOpen(false);
    setDisclaimer(false);
    showToast("Pedido enviado! ðŸŽ‰");
    setView("catalog");
  }

  function showToast(msg, type = "success") {
    setToast({ msg, type });
    setTimeout(() => setToast(null), 3000);
  }

  function saveName(n) { setMyName(n); localStorage.setItem("vg-nome", n); }

  // Cart for current user
  const myOrders = useMemo(() => orders.filter(o => o.buyerName.toLowerCase() === myName.toLowerCase()), [orders, myName]);
  const myTotal  = useMemo(() => myOrders.reduce((s, o) => s + o.qty * (products.find(p => p.id === o.peptideId)?.price || 0), 0), [myOrders]);
  const cartCount = myOrders.reduce((s, o) => s + o.qty, 0);

  function openModal(peptide) {
    setModal({ peptide });
    setFormName(myName);
    setFormQty(1);
  }

  function handleAddToCart() {
    const name = formName.trim();
    if (!name || formQty < 1) return;
    const existing = orders.find(o => o.peptideId === modal.peptide.id && o.buyerName.toLowerCase() === name.toLowerCase());
    let newOrders;
    if (existing) {
      newOrders = orders.map(o => o === existing ? { ...o, qty: o.qty + formQty } : o);
      showToast(`${modal.peptide.name} atualizado no carrinho âœ“`);
    } else {
      const newOrder = { id: Date.now(), peptideId: modal.peptide.id, buyerName: name, qty: formQty, createdAt: new Date().toISOString() };
      newOrders = [...orders, newOrder];
      showToast(`${modal.peptide.name} adicionado ao carrinho âœ“`);
    }
    saveName(name);
    persistOrders(newOrders);
    setModal(null);
  }

  function updateQtyInCart(orderId, delta) {
    const order = orders.find(o => o.id === orderId);
    if (!order) return;
    const newQty = order.qty + delta;
    if (newQty <= 0) {
      persistOrders(orders.filter(o => o.id !== orderId));
      showToast("Item removido do carrinho", "info");
    } else {
      persistOrders(orders.map(o => o.id === orderId ? { ...o, qty: newQty } : o));
    }
  }

  function removeFromCart(orderId) {
    persistOrders(orders.filter(o => o.id !== orderId));
    showToast("Item removido", "info");
  }

  function handleAdminUnlock() {
    const pw = window.prompt("CÃ³digo de administrador:");
    if (pw === ADMIN_PASS) { setAdminUnlocked(true); showToast("Admin desbloqueado âœ“"); setView("admin"); }
    else showToast("CÃ³digo incorreto!", "error");
  }

  function adminRemove(orderId) {
    persistOrders(orders.filter(o => o.id !== orderId));
    showToast("Pedido removido", "info");
  }

  function copyWhatsApp() {
    const grouped = {};
    orders.forEach(o => {
      const p = products.find(x => x.id === o.peptideId);
      if (!p) return;
      if (!grouped[p.name]) grouped[p.name] = [];
      grouped[p.name].push(o);
    });
    let text = "ðŸ§¬ *VANGUARD PEPTIDES â€” PEDIDOS*\n\n";
    Object.entries(grouped).forEach(([pName, items]) => {
      const total = items.reduce((s, o) => s + o.qty, 0);
      text += `*${pName}* (${total} und)\n`;
      items.forEach(o => { text += `â€¢ ${o.buyerName} Ã—${o.qty}\n`; });
      text += "\n";
    });
    navigator.clipboard.writeText(text).then(() => showToast("Lista copiada! ðŸ“‹")).catch(() => showToast("Erro ao copiar", "error"));
  }

  // â”€â”€ totals for admin â”€â”€
  const totalRevenue = useMemo(() => orders.reduce((s, o) => s + o.qty * (products.find(p => p.id === o.peptideId)?.price || 0), 0), [orders, products]);
  const totalUnits   = useMemo(() => orders.reduce((s, o) => s + o.qty, 0), [orders]);
  const totalBuyers  = useMemo(() => new Set(orders.map(o => o.buyerName.toLowerCase())).size, [orders]);

  // â”€â”€ cat groups â”€â”€
  const catGroups = CATEGORIES.filter(c => c.id !== "all").map(c => ({
    cat: c,
    peptides: (activeCat === "all" ? products : products.filter(p => p.category === activeCat)).filter(p => p.category === c.id)
  })).filter(g => g.peptides.length);

  function peptideCartQty(peptideId) {
    return myOrders.filter(o => o.peptideId === peptideId).reduce((s, o) => s + o.qty, 0);
  }

  return (
    <div>
      {toast && <div className={`toast ${toast.type}`}>{toast.msg}</div>}

      {/* CHECKOUT MODAL */}
      {checkoutOpen && (() => {
        const freight = calcFreight(checkout.estado, myTotal);
        const totalFinal = myTotal + freight.value;
        const isFree = freight.value === 0;
        return (
          <div className="modal-overlay" onClick={e=>{ if(e.target===e.currentTarget) setCheckoutOpen(false); }}>
            <div className="checkout-modal">
              <div className="modal-title">ðŸ“¦ Finalizar Pedido</div>
              <div className="modal-sub" style={{marginBottom:22}}>Preencha seus dados para enviar o pedido via WhatsApp.</div>

              {/* Dados pessoais */}
              <div className="checkout-section">
                <div className="checkout-section-title">ðŸ‘¤ Dados Pessoais</div>
                <div className="input-group">
                  <label>Nome completo *</label>
                  <input placeholder="Seu nome completo" value={checkout.nomeCompleto}
                    className={checkoutErrors.nomeCompleto ? 'error' : ''}
                    onChange={e=>updateCheckout('nomeCompleto', e.target.value)} />
                </div>
                <div className="input-row">
                  <div className="input-group">
                    <label>CPF *</label>
                    <input placeholder="000.000.000-00" value={checkout.cpf}
                      className={checkoutErrors.cpf ? 'error' : ''}
                      onChange={e=>updateCheckout('cpf', e.target.value)} />
                  </div>
                  <div className="input-group">
                    <label>Telefone *</label>
                    <input placeholder="(00) 00000-0000" value={checkout.telefone}
                      className={checkoutErrors.telefone ? 'error' : ''}
                      onChange={e=>updateCheckout('telefone', e.target.value)} />
                  </div>
                </div>
                <div className="input-group">
                  <label>E-mail *</label>
                  <input placeholder="seu@email.com" type="email" value={checkout.email}
                    className={checkoutErrors.email ? 'error' : ''}
                    onChange={e=>updateCheckout('email', e.target.value)} />
                </div>
              </div>

              {/* EndereÃ§o */}
              <div className="checkout-section">
                <div className="checkout-section-title">ðŸ“ EndereÃ§o de Entrega</div>
                <div className="input-row">
                  <div className="input-group">
                    <label>CEP *</label>
                    <input placeholder="00000-000" value={checkout.cep}
                      className={checkoutErrors.cep ? 'error' : ''}
                      onChange={e=>{ updateCheckout('cep', e.target.value); fetchCep(e.target.value); }} />
                  </div>
                  <div className="input-group">
                    <label>Estado</label>
                    <input placeholder="SP" value={checkout.estado}
                      className={checkoutErrors.estado ? 'error' : ''}
                      onChange={e=>updateCheckout('estado', e.target.value.toUpperCase())} />
                  </div>
                </div>
                <div className="input-group">
                  <label>Cidade</label>
                  <input placeholder="SÃ£o Paulo" value={checkout.cidade}
                    className={checkoutErrors.cidade ? 'error' : ''}
                    onChange={e=>updateCheckout('cidade', e.target.value)} />
                </div>
                <div className="input-group">
                  <label>Bairro</label>
                  <input placeholder="Centro" value={checkout.bairro}
                    onChange={e=>updateCheckout('bairro', e.target.value)} />
                </div>
                <div className="input-row">
                  <div className="input-group" style={{flex:2}}>
                    <label>Rua / Avenida *</label>
                    <input placeholder="Rua Exemplo" value={checkout.rua}
                      className={checkoutErrors.rua ? 'error' : ''}
                      onChange={e=>updateCheckout('rua', e.target.value)} />
                  </div>
                  <div className="input-group">
                    <label>NÃºmero *</label>
                    <input placeholder="123" value={checkout.numero}
                      className={checkoutErrors.numero ? 'error' : ''}
                      onChange={e=>updateCheckout('numero', e.target.value)} />
                  </div>
                </div>
                <div className="input-group">
                  <label>Complemento</label>
                  <input placeholder="Apto, bloco, referÃªncia..." value={checkout.complemento}
                    onChange={e=>updateCheckout('complemento', e.target.value)} />
                </div>
              </div>

              {/* Pagamento */}
              <div className="checkout-section">
                <div className="checkout-section-title">ðŸ’³ Forma de Pagamento</div>
                <div style={{display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:8}}>
                  {[
                    { id:'pix',  icon:'âš¡', label:'PIX', sub:'Ã€ vista' },
                    { id:'2x',   icon:'ðŸ’³', label:'2x CartÃ£o', sub:'Juros Mercado Pago' },
                    { id:'3x',   icon:'ðŸ’³', label:'3x CartÃ£o', sub:'Juros Mercado Pago' },
                  ].map(opt => (
                    <div key={opt.id} onClick={()=>updateCheckout('pagamento', opt.id)}
                      style={{
                        border: `1px solid ${checkout.pagamento===opt.id ? 'rgba(0,229,195,0.4)' : (checkoutErrors.pagamento ? 'rgba(255,107,53,0.5)' : 'var(--border)')}`,
                        borderRadius:10, padding:'12px 10px', cursor:'pointer', textAlign:'center',
                        background: checkout.pagamento===opt.id ? 'rgba(0,229,195,0.07)' : 'rgba(255,255,255,0.02)',
                        transition:'all 0.18s'
                      }}>
                      <div style={{fontSize:'1.3rem', marginBottom:4}}>{opt.icon}</div>
                      <div style={{fontFamily:"'Syne',sans-serif", fontWeight:700, fontSize:'0.82rem', color: checkout.pagamento===opt.id ? 'var(--accent)' : 'var(--text)'}}>{opt.label}</div>
                      <div style={{fontSize:'0.65rem', color:'var(--muted)', marginTop:2}}>{opt.sub}</div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Resumo + frete */}
              <div className="checkout-section">
                <div className="checkout-section-title">ðŸ’° Resumo do Pedido</div>
                <div style={{display:'flex',justifyContent:'space-between',fontSize:'0.83rem',color:'var(--muted)',marginBottom:8}}>
                  <span>Subtotal ({myOrders.reduce((s,o)=>s+o.qty,0)} itens)</span>
                  <span style={{color:'var(--text)',fontFamily:"'Space Mono',monospace"}}>R$ {myTotal.toLocaleString('pt-BR')}</span>
                </div>
                <div className={`freight-box ${isFree?'free':'paid'}`}>
                  <div className="freight-label">
                    <strong>{isFree ? 'ðŸŽ‰ Frete GrÃ¡tis' : 'ðŸšš Frete'}</strong>
                    <small>{freight.reason}</small>
                  </div>
                  <div className={`freight-value ${isFree?'free':'paid'}`}>{isFree ? 'GRÃTIS' : 'R$ 60'}</div>
                </div>
                {!isFree && myTotal < 600 && (
                  <div style={{fontSize:'0.75rem',color:'var(--muted)',marginTop:6,padding:'8px 12px',background:'rgba(0,168,255,0.04)',border:'1px solid rgba(0,168,255,0.12)',borderRadius:8}}>
                    ðŸ’¡ Faltam <strong style={{color:'var(--accent2)'}}>R$ {(600 - myTotal).toLocaleString('pt-BR')}</strong> para frete grÃ¡tis em SP, ou <strong style={{color:'var(--accent)'}}>R$ {(1000 - myTotal).toLocaleString('pt-BR')}</strong> para frete grÃ¡tis em qualquer estado.
                  </div>
                )}
                <div className="order-total-row">
                  <span className="order-total-label">Total final</span>
                  <span className="order-total-value">R$ {totalFinal.toLocaleString('pt-BR')}</span>
                </div>
              </div>

              {/* ObservaÃ§Ãµes */}
              <div className="checkout-section">
                <div className="checkout-section-title">ðŸ“ ObservaÃ§Ãµes</div>
                <div className="input-group">
                  <label>Alguma instruÃ§Ã£o especial? (opcional)</label>
                  <input placeholder="Ex: pode entregar apÃ³s 18h, portÃ£o azul..." value={checkout.observacoes||''}
                    onChange={e=>updateCheckout('observacoes', e.target.value)} />
                </div>
              </div>

              {/* Disclaimer */}
              <div style={{
                background: disclaimer ? 'rgba(0,229,195,0.04)' : 'rgba(255,107,53,0.04)',
                border: `1px solid ${disclaimer ? 'rgba(0,229,195,0.2)' : 'rgba(255,107,53,0.2)'}`,
                borderRadius:10, padding:'14px 16px', marginBottom:16, cursor:'pointer',
                display:'flex', gap:12, alignItems:'flex-start', transition:'all 0.2s'
              }} onClick={()=>setDisclaimer(d=>!d)}>
                <div style={{
                  width:20, height:20, borderRadius:5, flexShrink:0, marginTop:1,
                  border: `2px solid ${disclaimer ? 'var(--accent)' : 'rgba(255,107,53,0.5)'}`,
                  background: disclaimer ? 'var(--accent)' : 'transparent',
                  display:'flex', alignItems:'center', justifyContent:'center',
                  fontSize:'0.75rem', color:'#050a0e', fontWeight:700, transition:'all 0.2s'
                }}>{disclaimer ? 'âœ“' : ''}</div>
                <div style={{fontSize:'0.77rem', color:'var(--muted)', lineHeight:1.6}}>
                  <strong style={{color:'var(--text)'}}>Aviso Legal *</strong><br/>
                  Declaro que tenho 18 anos ou mais e que este produto Ã© adquirido exclusivamente para fins de pesquisa cientÃ­fica. NÃ£o me responsabilizo pelo uso indevido dos compostos.
                </div>
              </div>

              <button className="modal-confirm-btn" onClick={sendToWhatsApp}>
                ENVIAR PEDIDO VIA WHATSAPP â†’
              </button>
              <button className="modal-cancel-btn" onClick={()=>setCheckoutOpen(false)}>cancelar</button>
            </div>
          </div>
        );
      })()}

      {/* NAV */}
      <nav>
        <div className="logo">
          <div className="logo-dot"></div>
          VANGUARD
          <span className="logo-sub">PEPTIDES</span>
        </div>
        <div className="nav-right">
          <button className={`nav-btn ${view==="catalog"?"active":""}`} onClick={()=>setView("catalog")}>CATÃLOGO</button>
          <button className={`nav-btn ${view==="calc"?"active":""}`} onClick={()=>setView("calc")}>ðŸ’Š CALC</button>
          <button className={`cart-nav-btn ${view==="cart"?"active":""}`} onClick={()=>setView("cart")}>
            ðŸ›’ CARRINHO
            {cartCount > 0 && <span className="cart-badge">{cartCount}</span>}
          </button>
          <button className="nav-btn" onClick={adminUnlocked ? ()=>setView("admin") : handleAdminUnlock}>
            {adminUnlocked ? "ADMIN âœ“" : "ADMIN"}
          </button>
        </div>
      </nav>

      <div className="app">
        {/* SIDEBAR */}
        <aside>
          <label className="name-input-label">Seu nome</label>
          <input className="name-input" value={myName} onChange={e=>saveName(e.target.value)} placeholder="Como quer ser identificado" />

          <div className="sidebar-section-title">Categorias</div>
          {CATEGORIES.map(c => {
            const count = c.id === "all" ? products.length : products.filter(p => p.category === c.id).length;
            return (
              <button key={c.id} className={`cat-btn ${activeCat===c.id?"active":""}`}
                onClick={()=>{ setActiveCat(c.id); setView("catalog"); }}>
                <div className="cat-btn-icon" style={{background: c.color}}>{c.icon}</div>
                <span className="cat-btn-name">{c.name}</span>
                <span className="cat-btn-count">{count}</span>
              </button>
            );
          })}

          {myName && myTotal > 0 && <>
            <div className="sidebar-divider"></div>
            <div className="cart-mini" onClick={()=>setView("cart")}>
              <div className="cart-mini-label">MEU CARRINHO</div>
              <div className="cart-mini-total">R$ {myTotal.toLocaleString("pt-BR")}</div>
              <div className="cart-mini-sub">{myOrders.length} produto{myOrders.length!==1?"s":""} Â· sem frete</div>
            </div>
          </>}

          <div style={{flex:1}}></div>
          <button className="copy-btn" onClick={copyWhatsApp}>ðŸ“‹ Copiar lista WhatsApp</button>
        </aside>

        {/* MAIN */}
        <main>
          {/* CATALOG */}
          <div className={`view ${view==="catalog"?"visible":""}`}>
            <div className="page-tag">â–¸ CATÃLOGO</div>
            <div className="page-title">PeptÃ­deos Premium</div>
            <div className="page-sub">Adicione produtos ao carrinho e finalize seu pedido.</div>

            {catGroups.map(({ cat, peptides }) => (
              <div className="cat-section" key={cat.id}>
                <div className="cat-section-header">
                  <div className="cat-section-icon" style={{background: cat.color}}>{cat.icon}</div>
                  <div className="cat-section-title">{cat.name}</div>
                  <div className="cat-section-count">{peptides.length} produto{peptides.length!==1?"s":""}</div>
                </div>
                <div className="products-grid">
                  {peptides.map(peptide => {
                    const inCartQty = peptideCartQty(peptide.id);
                    const cartOrder = myOrders.find(o => o.peptideId === peptide.id);
                    return (
                      <div key={peptide.id} className={`product-card ${inCartQty>0?"in-cart":""} ${stock[peptide.id]===0?"esgotado":""}`} style={{position:'relative'}}>
                        {stock[peptide.id]===0 && <div className="esgotado-badge">ESGOTADO</div>}
                        <div className="vial-wrap">
                          <VialSVG name={peptide.name} dose={peptide.name.match(/(\d+\s*m[gcl]+)/i)?.[1]||''} sku={peptide.sku||peptide.id.toUpperCase()} />
                        </div>
                        {peptide.sku && <div style={{fontFamily:"'Space Mono',monospace",fontSize:"0.6rem",color:"var(--muted)",marginBottom:6}}>{peptide.sku}</div>}
                        <div className="product-card-name">{peptide.name}</div>
                        <div className="product-card-desc">{peptide.desc}</div>
                        <div className="product-card-price">R$ {peptide.price.toLocaleString("pt-BR")} <span>/ampola</span></div>

                        {inCartQty > 0 && cartOrder && (
                          <div className="in-cart-indicator">
                            <span className="in-cart-text">âœ“ NO CARRINHO</span>
                            <div className="in-cart-qty-controls">
                              <button className="qty-control-btn" onClick={()=>updateQtyInCart(cartOrder.id, -1)}>âˆ’</button>
                              <span className="qty-control-num">{inCartQty}</span>
                              <button className="qty-control-btn" onClick={()=>updateQtyInCart(cartOrder.id, +1)}>+</button>
                            </div>
                          </div>
                        )}

                        <button className="add-to-cart-btn" onClick={()=>openModal(peptide)} disabled={stock[peptide.id]===0}>
                          {stock[peptide.id]===0 ? "PRODUTO ESGOTADO" : inCartQty > 0 ? "+ ADICIONAR MAIS" : "ADICIONAR AO CARRINHO"}
                        </button>
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
          </div>

          {/* CART */}
          <div className={`view ${view==="cart"?"visible":""}`}>
            <div className="page-tag">â–¸ CARRINHO</div>
            <div className="page-title">{myName || "Carrinho"}</div>
            <div className="page-sub">Revise seus produtos antes de confirmar o pedido.</div>

            {!myName && (
              <div className="cart-empty">
                <div className="cart-empty-icon">ðŸ‘¤</div>
                <div className="cart-empty-title">Digite seu nome na sidebar</div>
                <div className="cart-empty-sub">Precisamos identificar seu pedido.</div>
              </div>
            )}

            {myName && myOrders.length === 0 && (
              <div className="cart-empty">
                <div className="cart-empty-icon">ðŸ›’</div>
                <div className="cart-empty-title">Carrinho vazio</div>
                <div className="cart-empty-sub">VÃ¡ ao catÃ¡logo e adicione seus peptÃ­deos.</div>
              </div>
            )}

            {myName && myOrders.length > 0 && (() => {
              return (
                <div>
                  <div className="cart-items">
                    {myOrders.map(order => {
                      const p = products.find(x => x.id === order.peptideId);
                      if (!p) return null;
                      const cat = CATEGORIES.find(c => c.id === p.category);
                      return (
                        <div key={order.id} className="cart-item-card">
                          <div className="cart-item-emoji" style={{background: cat?.color || "rgba(0,229,195,0.15)"}}>{cat?.icon}</div>
                          <div className="cart-item-info">
                            <div className="cart-item-name">{p.name}</div>
                            <div className="cart-item-buyer">R$ {p.price}/ampola</div>
                          </div>
                          <div className="cart-item-qty-wrap">
                            <button className="qty-control-btn" onClick={()=>updateQtyInCart(order.id, -1)}>âˆ’</button>
                            <span className="qty-control-num" style={{fontSize:"0.9rem",minWidth:24}}>{order.qty}</span>
                            <button className="qty-control-btn" onClick={()=>updateQtyInCart(order.id, +1)}>+</button>
                          </div>
                          <div className="cart-item-price">R$ {(p.price * order.qty).toLocaleString("pt-BR")}</div>
                          <button className="cart-item-remove" onClick={()=>removeFromCart(order.id)} title="Remover">âœ•</button>
                        </div>
                      );
                    })}
                  </div>

                  <div className="cart-summary">
                    {myOrders.map(order => {
                      const p = products.find(x => x.id === order.peptideId);
                      if (!p) return null;
                      return (
                        <div key={order.id} className="cart-summary-row">
                          <span>{p.name} Ã—{order.qty}</span>
                          <span>R$ {(p.price * order.qty).toLocaleString("pt-BR")}</span>
                        </div>
                      );
                    })}
                    <div className="cart-summary-total">
                      <div className="cart-summary-total-label">Total (s/ frete)</div>
                      <div className="cart-summary-total-value">R$ {myTotal.toLocaleString("pt-BR")}</div>
                    </div>
                  </div>

                  <div className="cart-note">
                    ðŸ’§ <strong>Ãgua bacteriostÃ¡tica inclusa gratuitamente</strong> em todos os pedidos. Frete calculado e informado apÃ³s confirmaÃ§Ã£o.
                  </div>

                  <button className="checkout-btn" onClick={()=>setCheckoutOpen(true)}>
                    FINALIZAR PEDIDO â†’
                  </button>
                </div>
              );
            })()}
          </div>

          {/* ADMIN */}
          <div className={`view ${view==="admin"?"visible":""}`}>
            <div className="page-tag">â–¸ ADMINISTRADOR</div>
            <div className="page-title">Painel Admin</div>

            <div className="admin-grid" style={{marginBottom:24}}>
              <div className="admin-stat"><div className="admin-stat-label">Compradores</div><div className="admin-stat-value">{totalBuyers}</div></div>
              <div className="admin-stat"><div className="admin-stat-label">Total unidades</div><div className="admin-stat-value">{totalUnits}</div></div>
              <div className="admin-stat"><div className="admin-stat-label">Receita bruta</div><div className="admin-stat-value">R$ {totalRevenue.toLocaleString("pt-BR")}</div></div>
              <div className="admin-stat"><div className="admin-stat-label">Produtos</div><div className="admin-stat-value">{products.length}</div></div>
            </div>

            {/* TABS */}
            <div className="admin-tabs">
              <button className={`admin-tab ${adminTab==="pedidos"?"active":""}`} onClick={()=>setAdminTab("pedidos")}>ðŸ“‹ PEDIDOS</button>
              <button className={`admin-tab ${adminTab==="estoque"?"active":""}`} onClick={()=>setAdminTab("estoque")}>ðŸ“¦ ESTOQUE</button>
              <button className={`admin-tab ${adminTab==="produtos"?"active":""}`} onClick={()=>setAdminTab("produtos")}>âš—ï¸ PRODUTOS</button>
            </div>

            {/* TAB: PEDIDOS */}
            {adminTab==="pedidos" && <>
              <div className="admin-actions">
                <button className="admin-action-btn" onClick={copyWhatsApp}>ðŸ“‹ Copiar lista WhatsApp</button>
                <button className="admin-action-btn danger" onClick={()=>{ if(window.confirm("Apagar TODOS os pedidos?")){ persistOrders([]); showToast("Pedidos apagados", "info"); }}}>ðŸ—‘ï¸ Limpar tudo</button>
              </div>
              {orders.length === 0 && (
                <div style={{textAlign:"center",color:"var(--muted)",padding:40,fontSize:"0.85rem"}}>Nenhum pedido ainda</div>
              )}
              {orders.length > 0 && (
                <div className="admin-table">
                  <div className="admin-table-header">
                    <span>Produto</span>
                    <span>Comprador</span>
                    <span>Qtd</span>
                    <span>Total</span>
                    <span></span>
                  </div>
                  {orders.map(order => {
                    const p = products.find(x => x.id === order.peptideId);
                    if (!p) return null;
                    return (
                      <div key={order.id} className="admin-table-row">
                        <div>
                          <div className="admin-row-name">{p.name}</div>
                          <div className="admin-row-buyer">R$ {p.price}/un</div>
                        </div>
                        <div style={{color:"#a8bfc9"}}>{order.buyerName}</div>
                        <div className="admin-row-qty">Ã—{order.qty}</div>
                        <div className="admin-row-total">R$ {(p.price*order.qty).toLocaleString("pt-BR")}</div>
                        <div><button className="admin-remove-btn" onClick={()=>adminRemove(order.id)}>remover</button></div>
                      </div>
                    );
                  })}
                  <div style={{padding:"14px 20px",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"flex-end",gap:24,fontFamily:"'Space Mono',monospace",fontSize:"0.78rem"}}>
                    <span style={{color:"var(--muted)"}}>TOTAL GERAL</span>
                    <span style={{color:"var(--accent)",fontWeight:700}}>R$ {totalRevenue.toLocaleString("pt-BR")}</span>
                  </div>
                </div>
              )}
            </>}

            {/* TAB: ESTOQUE */}
            {adminTab==="estoque" && <>
              <div className="stock-table">
                {products.map(p => {
                  const qty = stock[p.id] ?? null;
                  const qtyClass = qty === null ? 'ok' : qty === 0 ? 'zero' : qty <= 3 ? 'low' : 'ok';
                  return (
                    <div key={p.id} className="stock-row">
                      <div>
                        <div className="stock-name">{p.name}</div>
                        <div className="stock-sku">{p.sku || p.id.toUpperCase()}</div>
                      </div>
                      <div className={`stock-qty ${qtyClass}`}>
                        {qty === null ? 'âˆž' : qty}
                      </div>
                      <div className="stock-ctrl">
                        <button className="stock-btn" onClick={()=>{
                          const cur = stock[p.id] ?? 0;
                          persistStock({...stock, [p.id]: Math.max(0, cur-1)});
                        }}>âˆ’</button>
                        <input type="number" className="stock-input" min="0"
                          value={stock[p.id] ?? ''}
                          placeholder="âˆž"
                          onChange={e=>{
                            const v = e.target.value;
                            if (v === '') {
                              const ns = {...stock}; delete ns[p.id]; persistStock(ns);
                            } else {
                              const n = parseInt(v); if(!isNaN(n) && n>=0) persistStock({...stock, [p.id]: n});
                            }
                          }}
                        />
                        <button className="stock-btn" onClick={()=>{
                          const cur = stock[p.id] ?? 0;
                          persistStock({...stock, [p.id]: cur+1});
                        }}>+</button>
                      </div>
                      <div style={{fontSize:"0.7rem",color:"var(--muted)",fontFamily:"'Space Mono',monospace"}}>
                        {stock[p.id]===0 ? <span style={{color:"#ff5050"}}>ESGOTADO</span> : stock[p.id]===undefined ? 'Sem controle' : stock[p.id]<=3 ? <span style={{color:"var(--warn)"}}>BAIXO</span> : 'OK'}
                      </div>
                    </div>
                  );
                })}
              </div>
              <div style={{marginTop:12,fontSize:"0.75rem",color:"var(--muted)",textAlign:"center"}}>
                Campo vazio = sem controle de estoque (produto sempre disponÃ­vel) Â· 0 = ESGOTADO
              </div>
            </>}

            {/* TAB: PRODUTOS */}
            {adminTab==="produtos" && (() => {
              const emptyForm = { sku:'', name:'', desc:'', category:'emagrecedores', price:'' };
              const editing = prodForm && prodForm.id ? products.find(p=>p.id===prodForm.id) : null;
              const form = prodForm || {};

              function saveProd() {
                if (!form.name?.trim() || !form.price) { showToast("Nome e preÃ§o sÃ£o obrigatÃ³rios", "error"); return; }
                const price = parseFloat(form.price);
                if (isNaN(price)) { showToast("PreÃ§o invÃ¡lido", "error"); return; }
                if (editing) {
                  persistProducts(products.map(p => p.id===editing.id ? {...p, ...form, price} : p));
                  showToast("Produto atualizado âœ“");
                } else {
                  const id = (form.name||'').toLowerCase().replace(/[^a-z0-9]/g,'').slice(0,20) + Date.now();
                  persistProducts([...products, { id, sku: form.sku||id.toUpperCase(), name: form.name, desc: form.desc||'', category: form.category||'emagrecedores', price }]);
                  showToast("Produto criado âœ“");
                }
                setProdForm(null);
              }

              return <>
                {/* FORM */}
                {prodForm !== null && (
                  <div className="prod-form">
                    <div className="prod-form-title">{editing ? 'âœï¸ Editar Produto' : 'ï¼‹ Novo Produto'}</div>
                    <div className="prod-form-grid">
                      <div className="prod-form-group">
                        <label>SKU</label>
                        <input placeholder="ex: RT15" value={form.sku||''} onChange={e=>setProdForm(f=>({...f,sku:e.target.value}))} />
                      </div>
                      <div className="prod-form-group">
                        <label>PreÃ§o (R$) *</label>
                        <input type="number" placeholder="299" value={form.price||''} onChange={e=>setProdForm(f=>({...f,price:e.target.value}))} />
                      </div>
                      <div className="prod-form-group prod-form-full">
                        <label>Nome do produto *</label>
                        <input placeholder="Retatrutida 15mg" value={form.name||''} onChange={e=>setProdForm(f=>({...f,name:e.target.value}))} />
                      </div>
                      <div className="prod-form-group prod-form-full">
                        <label>DescriÃ§Ã£o</label>
                        <textarea placeholder="Breve descriÃ§Ã£o do produto..." value={form.desc||''} onChange={e=>setProdForm(f=>({...f,desc:e.target.value}))} />
                      </div>
                      <div className="prod-form-group">
                        <label>Categoria</label>
                        <select value={form.category||'emagrecedores'} onChange={e=>setProdForm(f=>({...f,category:e.target.value}))}>
                          {CATEGORIES.filter(c=>c.id!=="all").map(c=>(
                            <option key={c.id} value={c.id}>{c.icon} {c.name}</option>
                          ))}
                        </select>
                      </div>
                    </div>
                    <div style={{display:"flex",gap:8,marginTop:16}}>
                      <button className="admin-action-btn" onClick={saveProd}>ðŸ’¾ Salvar</button>
                      <button className="admin-action-btn" style={{background:"transparent"}} onClick={()=>setProdForm(null)}>Cancelar</button>
                    </div>
                  </div>
                )}

                {/* LIST */}
                <div style={{display:"flex",justifyContent:"flex-end",marginBottom:12}}>
                  <button className="admin-action-btn" onClick={()=>setProdForm({sku:'',name:'',desc:'',category:'emagrecedores',price:''})}>ï¼‹ Novo Produto</button>
                </div>
                <div className="prod-list">
                  {products.map(p=>(
                    <div key={p.id} className="prod-list-row">
                      <div className="prod-list-sku">{p.sku||'â€”'}</div>
                      <div>
                        <div className="prod-list-name">{p.name}</div>
                        <div className="prod-list-cat">{CATEGORIES.find(c=>c.id===p.category)?.icon} {CATEGORIES.find(c=>c.id===p.category)?.name}</div>
                      </div>
                      <div className="prod-list-price">R$ {p.price.toLocaleString("pt-BR")}</div>
                      <button className="prod-edit-btn" onClick={()=>setProdForm({...p, price: p.price.toString()})}>editar</button>
                      <button className="prod-del-btn" onClick={()=>{
                        if(window.confirm(`Remover "${p.name}"?`)){
                          persistProducts(products.filter(x=>x.id!==p.id));
                          showToast("Produto removido", "info");
                        }
                      }}>excluir</button>
                    </div>
                  ))}
                </div>
                <div style={{marginTop:10,textAlign:"right"}}>
                  <button style={{background:"none",border:"none",color:"var(--muted)",fontSize:"0.72rem",cursor:"pointer",fontFamily:"'Space Mono',monospace"}}
                    onClick={()=>{ if(window.confirm("Restaurar lista padrÃ£o de produtos?")){ persistProducts(DEFAULT_PEPTIDES); showToast("Produtos restaurados", "info"); }}}>
                    â†º Restaurar padrÃ£o
                  </button>
                </div>
              </>;
            })()}
          </div>

          {/* CALCULADORA */}
          <div className={`view ${view==="calc"?"visible":""}`}>
            <div className="page-tag">â–¸ CALCULADORA</div>
            <div className="page-title">Calculadora de Dose</div>
            <div className="page-sub">Calcule dose, reconstituiÃ§Ã£o com Ã¡gua bacteriostÃ¡tica e duraÃ§Ã£o do frasco.</div>
            <CalcView />
          </div>
        </main>
      </div>

      {/* ADD TO CART MODAL */}
      {modal && (
        <div className="modal-overlay" onClick={()=>setModal(null)}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div style={{fontFamily:"'Space Mono',monospace",fontSize:"0.62rem",color:"var(--accent)",letterSpacing:"1.5px",marginBottom:6}}>
              {CATEGORIES.find(c=>c.id===modal.peptide.category)?.icon} {CATEGORIES.find(c=>c.id===modal.peptide.category)?.name?.toUpperCase()}
            </div>
            <div className="modal-title">{modal.peptide.name}</div>
            <div className="modal-sub">{modal.peptide.desc}</div>

            <label className="modal-label">Seu nome</label>
            <input className="modal-input" value={formName} onChange={e=>setFormName(e.target.value)} placeholder="Como deseja ser identificado" autoFocus />

            <label className="modal-label">Quantidade</label>
            <div className="qty-row">
              <button className="qty-big-btn" onClick={()=>setFormQty(q=>Math.max(1,q-1))}>âˆ’</button>
              <div className="qty-big-num">{formQty}</div>
              <button className="qty-big-btn" onClick={()=>setFormQty(q=>q+1)}>+</button>
            </div>

            <div className="price-preview">
              <div>
                <div className="price-preview-label">{formQty} ampola{formQty!==1?"s":""}</div>
                <div style={{fontSize:"0.7rem",color:"var(--muted)",marginTop:2}}>R$ {modal.peptide.price} Ã— {formQty}</div>
              </div>
              <div className="price-preview-value">R$ {(modal.peptide.price * formQty).toLocaleString("pt-BR")}</div>
            </div>

            <button className="modal-confirm-btn" onClick={handleAddToCart} disabled={!formName.trim()}>
              ðŸ›’ ADICIONAR AO CARRINHO
            </button>
            <button className="modal-cancel-btn" onClick={()=>setModal(null)}>CANCELAR</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
